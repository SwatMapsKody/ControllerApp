{% extends 'base_template.html' %}

{% block title %}
Landing Page - ControllerApp
{% endblock %}

{% block header %}
Welcome to the ControllerApp Landing Page
{% endblock %}

{% block content %}
<div class="primary-columns-container">
    <div class="column" id="column-1">
        {% if manufacturers %}
            {% for manufacturer in manufacturers %}
                <!-- Manufacturer Button -->
                <button onclick="loadControllers({{ manufacturer.id }}, '{{ manufacturer.name }}')" class="manufacturer-button">
                    {{ manufacturer.name }}
                </button>
            {% endfor %}
        {% else %}
            <p>Database is Empty</p>
        {% endif %}
    </div>

    <!-- Column for Controllers -->
    <div class="column" id="column-2"></div>

    <!-- Column for Versions and Workflows -->
    <div class="column" id="column-3"></div>
</div>

<!-- New Section for Selected Version -->
<div class="workflow-section" id="workflow-container" style="display: none;">
    <div class="workflow-header">
        <h2 id="workflow-title"></h2>
    </div>
    <div class="workflow-columns">
        <div class="workflow-column" id="workflow-column-1"></div>
        <div class="workflow-column" id="workflow-column-2"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script>
        function loadControllers(manufacturerId, manufacturerName) {
            $.ajax({
                url: `/controllers/${manufacturerId}/`,
                method: 'GET',
                success: function(data) {
                    let html = '';
                    data.forEach(controller => {
                        // Pass the manufacturerName correctly along with controllerId and model
                        html += `<button onclick="loadVersions(${controller.id}, '${controller.model}', '${manufacturerName}')" class="controller-button">${controller.model}</button>`;
                    });
                    $('#column-2').html(html);
                    $('#column-3').html(''); // Clear versions column
                    $('#workflow-container').hide(); // Hide workflow section
                }
            });
        }

        function loadVersions(controllerId, controllerModel, manufacturerName) {
            $.ajax({
                url: `/versions/${controllerId}/`,
                method: 'GET',
                success: function(data) {
                    let html = '';
                    data.forEach(version => {
                        // Pass the correct manufacturerName along with version details
                        html += `<button onclick="loadWorkflows(${version.id}, '${manufacturerName}', '${controllerModel}', '${version.version}')" class="version-button">${version.version}</button>`;
                    });
                    $('#column-3').html(html);
                    $('#workflow-container').hide(); // Hide workflow section
                }
            });
        }

        function loadWorkflows(versionId, manufacturerName, controllerName, versionName) {
            $.ajax({
                url: `/workflows/${versionId}/`,
                method: 'GET',
                success: function(data) {
                    let html = '';
                    data.forEach(workflow => {
                        html += `<button onclick="showAnswer('${workflow.question}', '${workflow.answer}')" class="workflow-button">${workflow.question}</button>`;
                    });
                    $('#workflow-column-1').html(html);
                    $('#workflow-column-2').html(''); // Clear previous answers
                    // Display the correct title with manufacturerName, controllerName, and versionName
                    $('#workflow-title').text(`${manufacturerName} - ${controllerName} - ${versionName}`);
                    $('#workflow-container').show(); // Show workflow section

                    // Check if the farm name input box already exists
                    if ($('#farm-name-input').length === 0) {
                        $('#workflow-column-2').append(`
                            <div class="farm-name">
                                <input type="text" id="farm-name-input" placeholder="Farm Name" oninput="updateFarmName(this.value)">
                            </div>
                            <div id="farm-name-display"></div>
                        `);
                    }
                }
            });
        }


        function updateFarmName(farmName) {
            // Update the content to include the farm name dynamically
            $('#farm-name-display').html(`<strong>Farm Name:</strong> ${farmName}`);
        }

        function showAnswer(question, answer) {
            // Append the question and answer to the existing content
            $('#workflow-column-2').append(`
                <div class="answer-content">
                    <strong>Question:</strong> ${question}
                    <br>
                    <strong>Answer:</strong> ${answer}
                </div>
            `);
        }
    </script>

{% endblock %}

